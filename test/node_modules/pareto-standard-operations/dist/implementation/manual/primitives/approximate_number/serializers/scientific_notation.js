"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.$$ = void 0;
const _ps = __importStar(require("pareto-core-serializer"));
const $$ = ($, $p) => {
    return _ps.build_text(($i) => {
        // Handle special case for zero in scientific notation
        if ($ === 0) {
            $i['add character'](48); // '0'
            // Add decimal point if we have more than 1 digit
            if ($p.digits > 1) {
                $i['add character'](46); // '.'
                // Add the required number of zeros after decimal point
                for (let i = 0; i < $p.digits - 1; i++) {
                    $i['add character'](48); // '0'
                }
            }
            // Add exponent part for zero: e+0
            $i['add character'](101); // 'e'
            $i['add character'](43); // '+'
            $i['add character'](48); // '0'
            return;
        }
        // Handle negative numbers
        if ($ < 0) {
            $i['add character'](45); // '-'
            $ = -$;
        }
        // Calculate exponent and mantissa for scientific notation
        let exponent = 0;
        let mantissa = $;
        // Normalize to range [1, 10)
        if (mantissa >= 10) {
            while (mantissa >= 10) {
                mantissa = mantissa / 10;
                exponent++;
            }
        }
        else if (mantissa < 1) {
            while (mantissa < 1) {
                mantissa = mantissa * 10;
                exponent--;
            }
        }
        // Create scale factor by multiplying
        let scale_factor = 1;
        for (let i = 0; i < $p.digits - 1; i++) {
            scale_factor = scale_factor * 10;
        }
        // Simple rounding using integer operations
        const mantissa_scaled = _ps.integer_division(mantissa * scale_factor + 0.5, 1, () => _ps.unreachable_code_path());
        // Convert mantissa to string
        const digits = _ps.build_list(($i) => {
            let temp = mantissa_scaled;
            // temp is always > 0 here since mantissa_scaled = integer_division(mantissa * scale_factor + 0.5, 1)
            // where mantissa >= 1.0 (normalized) and scale_factor >= 1, so result >= 1
            do {
                const digit = temp % 10;
                $i['add element'](digit);
                temp = _ps.integer_division(temp, 10, () => _ps.unreachable_code_path());
            } while (temp > 0);
        });
        // Add leading digit
        const first_digit = digits.__get_element_at(digits.get_number_of_elements() - 1).transform(($) => $, () => _ps.unreachable_code_path() // index cannot be out of bounds
        );
        $i['add character'](48 + first_digit); // First digit
        // Add decimal point if we have more digits
        if ($p.digits > 1 && digits.get_number_of_elements() > 1) {
            $i['add character'](46); // '.'
            // Add remaining digits in reverse order
            for (let j = digits.get_number_of_elements() - 2; j >= 0; j--) {
                const digit = digits.__get_element_at(j).transform(($) => $, () => _ps.unreachable_code_path() // index cannot be out of bounds
                );
                $i['add character'](48 + digit);
            }
        }
        // Add exponent part
        $i['add character'](101); // 'e'
        if (exponent < 0) {
            $i['add character'](45); // '-'
            exponent = -exponent;
        }
        else {
            $i['add character'](43); // '+'
        }
        // Convert exponent to string
        const exp_digits = _ps.build_list(($i) => {
            if (exponent === 0) {
                $i['add element'](0);
            }
            else {
                do {
                    const digit = exponent % 10;
                    $i['add element'](digit);
                    exponent = _ps.integer_division(exponent, 10, () => _ps.unreachable_code_path());
                } while (exponent > 0);
            }
        });
        // Add exponent digits in reverse order
        for (let j = exp_digits.get_number_of_elements() - 1; j >= 0; j--) {
            const digit = exp_digits.__get_element_at(j).transform(($) => $, () => _ps.unreachable_code_path() // index cannot be out of bounds
            );
            $i['add character'](48 + digit);
        }
    });
};
exports.$$ = $$;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NpZW50aWZpY19ub3RhdGlvbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9pbXBsZW1lbnRhdGlvbi9tYW51YWwvcHJpbWl0aXZlcy9hcHByb3hpbWF0ZV9udW1iZXIvc2VyaWFsaXplcnMvc2NpZW50aWZpY19ub3RhdGlvbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDREQUE2QztBQUl0QyxNQUFNLEVBQUUsR0FBNkUsQ0FBQyxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUU7SUFDbEcsT0FBTyxHQUFHLENBQUMsVUFBVSxDQUFDLENBQUMsRUFBRSxFQUFFLEVBQUU7UUFDekIsc0RBQXNEO1FBQ3RELElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDO1lBQ1YsRUFBRSxDQUFDLGVBQWUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFBLENBQUMsTUFBTTtZQUU5QixpREFBaUQ7WUFDakQsSUFBSSxFQUFFLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO2dCQUNoQixFQUFFLENBQUMsZUFBZSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUEsQ0FBQyxNQUFNO2dCQUU5Qix1REFBdUQ7Z0JBQ3ZELEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO29CQUNyQyxFQUFFLENBQUMsZUFBZSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUEsQ0FBQyxNQUFNO2dCQUNsQyxDQUFDO1lBQ0wsQ0FBQztZQUVELGtDQUFrQztZQUNsQyxFQUFFLENBQUMsZUFBZSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUEsQ0FBQyxNQUFNO1lBQy9CLEVBQUUsQ0FBQyxlQUFlLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQSxDQUFFLE1BQU07WUFDL0IsRUFBRSxDQUFDLGVBQWUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFBLENBQUUsTUFBTTtZQUMvQixPQUFNO1FBQ1YsQ0FBQztRQUVELDBCQUEwQjtRQUMxQixJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQztZQUNSLEVBQUUsQ0FBQyxlQUFlLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQSxDQUFDLE1BQU07WUFDOUIsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFBO1FBQ1YsQ0FBQztRQUVELDBEQUEwRDtRQUMxRCxJQUFJLFFBQVEsR0FBRyxDQUFDLENBQUE7UUFDaEIsSUFBSSxRQUFRLEdBQUcsQ0FBQyxDQUFBO1FBRWhCLDZCQUE2QjtRQUM3QixJQUFJLFFBQVEsSUFBSSxFQUFFLEVBQUUsQ0FBQztZQUNqQixPQUFPLFFBQVEsSUFBSSxFQUFFLEVBQUUsQ0FBQztnQkFDcEIsUUFBUSxHQUFHLFFBQVEsR0FBRyxFQUFFLENBQUE7Z0JBQ3hCLFFBQVEsRUFBRSxDQUFBO1lBQ2QsQ0FBQztRQUNMLENBQUM7YUFBTSxJQUFJLFFBQVEsR0FBRyxDQUFDLEVBQUUsQ0FBQztZQUN0QixPQUFPLFFBQVEsR0FBRyxDQUFDLEVBQUUsQ0FBQztnQkFDbEIsUUFBUSxHQUFHLFFBQVEsR0FBRyxFQUFFLENBQUE7Z0JBQ3hCLFFBQVEsRUFBRSxDQUFBO1lBQ2QsQ0FBQztRQUNMLENBQUM7UUFFRCxxQ0FBcUM7UUFDckMsSUFBSSxZQUFZLEdBQUcsQ0FBQyxDQUFBO1FBQ3BCLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO1lBQ3JDLFlBQVksR0FBRyxZQUFZLEdBQUcsRUFBRSxDQUFBO1FBQ3BDLENBQUM7UUFFRCwyQ0FBMkM7UUFDM0MsTUFBTSxlQUFlLEdBQUcsR0FBRyxDQUFDLGdCQUFnQixDQUFDLFFBQVEsR0FBRyxZQUFZLEdBQUcsR0FBRyxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxHQUFHLENBQUMscUJBQXFCLEVBQUUsQ0FBQyxDQUFBO1FBRWpILDZCQUE2QjtRQUM3QixNQUFNLE1BQU0sR0FBRyxHQUFHLENBQUMsVUFBVSxDQUFTLENBQUMsRUFBRSxFQUFFLEVBQUU7WUFDekMsSUFBSSxJQUFJLEdBQUcsZUFBZSxDQUFBO1lBQzFCLHFHQUFxRztZQUNyRywyRUFBMkU7WUFDM0UsR0FBRyxDQUFDO2dCQUNBLE1BQU0sS0FBSyxHQUFHLElBQUksR0FBRyxFQUFFLENBQUE7Z0JBQ3ZCLEVBQUUsQ0FBQyxhQUFhLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQTtnQkFDeEIsSUFBSSxHQUFHLEdBQUcsQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLEVBQUUsRUFBRSxFQUFFLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxxQkFBcUIsRUFBRSxDQUFDLENBQUE7WUFDNUUsQ0FBQyxRQUFRLElBQUksR0FBRyxDQUFDLEVBQUM7UUFDdEIsQ0FBQyxDQUFDLENBQUE7UUFFRixvQkFBb0I7UUFDcEIsTUFBTSxXQUFXLEdBQUcsTUFBTSxDQUFDLGdCQUFnQixDQUFDLE1BQU0sQ0FBQyxzQkFBc0IsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FDdEYsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsRUFDUixHQUFHLEVBQUUsQ0FBQyxHQUFHLENBQUMscUJBQXFCLEVBQUUsQ0FBQyxnQ0FBZ0M7U0FDckUsQ0FBQTtRQUNELEVBQUUsQ0FBQyxlQUFlLENBQUMsQ0FBQyxFQUFFLEdBQUcsV0FBVyxDQUFDLENBQUEsQ0FBQyxjQUFjO1FBRXBELDJDQUEyQztRQUMzQyxJQUFJLEVBQUUsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxzQkFBc0IsRUFBRSxHQUFHLENBQUMsRUFBRSxDQUFDO1lBQ3ZELEVBQUUsQ0FBQyxlQUFlLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQSxDQUFDLE1BQU07WUFFOUIsd0NBQXdDO1lBQ3hDLEtBQUssSUFBSSxDQUFDLEdBQUcsTUFBTSxDQUFDLHNCQUFzQixFQUFFLEdBQUcsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztnQkFDNUQsTUFBTSxLQUFLLEdBQUcsTUFBTSxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FDOUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsRUFDUixHQUFHLEVBQUUsQ0FBQyxHQUFHLENBQUMscUJBQXFCLEVBQUUsQ0FBQyxnQ0FBZ0M7aUJBQ3JFLENBQUE7Z0JBQ0QsRUFBRSxDQUFDLGVBQWUsQ0FBQyxDQUFDLEVBQUUsR0FBRyxLQUFLLENBQUMsQ0FBQTtZQUNuQyxDQUFDO1FBQ0wsQ0FBQztRQUVELG9CQUFvQjtRQUNwQixFQUFFLENBQUMsZUFBZSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUEsQ0FBQyxNQUFNO1FBQy9CLElBQUksUUFBUSxHQUFHLENBQUMsRUFBRSxDQUFDO1lBQ2YsRUFBRSxDQUFDLGVBQWUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFBLENBQUMsTUFBTTtZQUM5QixRQUFRLEdBQUcsQ0FBQyxRQUFRLENBQUE7UUFDeEIsQ0FBQzthQUFNLENBQUM7WUFDSixFQUFFLENBQUMsZUFBZSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUEsQ0FBQyxNQUFNO1FBQ2xDLENBQUM7UUFFRCw2QkFBNkI7UUFDN0IsTUFBTSxVQUFVLEdBQUcsR0FBRyxDQUFDLFVBQVUsQ0FBUyxDQUFDLEVBQUUsRUFBRSxFQUFFO1lBQzdDLElBQUksUUFBUSxLQUFLLENBQUMsRUFBRSxDQUFDO2dCQUNqQixFQUFFLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7WUFDeEIsQ0FBQztpQkFBTSxDQUFDO2dCQUNKLEdBQUcsQ0FBQztvQkFDQSxNQUFNLEtBQUssR0FBRyxRQUFRLEdBQUcsRUFBRSxDQUFBO29CQUMzQixFQUFFLENBQUMsYUFBYSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUE7b0JBQ3hCLFFBQVEsR0FBRyxHQUFHLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxFQUFFLEVBQUUsRUFBRSxHQUFHLEVBQUUsQ0FBQyxHQUFHLENBQUMscUJBQXFCLEVBQUUsQ0FBQyxDQUFBO2dCQUNwRixDQUFDLFFBQVEsUUFBUSxHQUFHLENBQUMsRUFBQztZQUMxQixDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUE7UUFFRix1Q0FBdUM7UUFDdkMsS0FBSyxJQUFJLENBQUMsR0FBRyxVQUFVLENBQUMsc0JBQXNCLEVBQUUsR0FBRyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO1lBQ2hFLE1BQU0sS0FBSyxHQUFHLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQ2xELENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEVBQ1IsR0FBRyxFQUFFLENBQUMsR0FBRyxDQUFDLHFCQUFxQixFQUFFLENBQUMsZ0NBQWdDO2FBQ3JFLENBQUE7WUFDRCxFQUFFLENBQUMsZUFBZSxDQUFDLENBQUMsRUFBRSxHQUFHLEtBQUssQ0FBQyxDQUFBO1FBQ25DLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQTtBQUNOLENBQUMsQ0FBQTtBQXZIWSxRQUFBLEVBQUUsTUF1SGQifQ==